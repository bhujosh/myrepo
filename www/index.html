<html>
	<head>
		<meta charset="utf-8" />
	        <meta name="format-detection" content="telephone=no" />
        	<meta name="msapplication-tap-highlight" content="no" />
	        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
	        <link rel="stylesheet" type="text/css" href="css/index.css" />
	        <title>Game1: Fruit Basket</title>
    	</head>
    	<body>
		<script type="text/javascript" src="cordova.js"></script>
        	<script type="text/javascript" src="js/index.js"></script>
	   	<script type="text/javascript" src="js/phaser.min.js"></script>			
    		<script type="text/javascript">
			var group1;
			var basket;
			var timer;
			var cursors;
			var sprite;
			var score=0;
			var scoreText;
			var esckey;
			var gameOverText;
			var wiw=window.innerWidth;
			var wih=window.innerHeight;
			var imageX;
			var imageY;	
			var game = new Phaser.Game(wiw, wih, Phaser.CANVAS, 'phaser-example', {preload: preload, create: create,update: update,render: render});
			function preload() 
			{
				game.load.image('basket', 'images/basket3.png');
			    	game.load.spritesheet('fandi', 'images/fruitsinsects.png', 64, 64);		   	
				game.load.image('sky','images/starrysky.png');
			}
			function create()
			{
				game.physics.startSystem(Phaser.Physics.ARCADE);
				game.physics.arcade.checkCollision.down=false;

				//added for mobile screens
				//this.scale.ScaleMode=Phaser.ScaleManager.USER_SCALE;
				//this.scale.setResizeCallback(this.gameResized,this);
				//--********************--

				background=game.add.image(0,0,'sky');	
				background.width=wiw;
				background.height=wih;

				cursors = game.input.keyboard.createCursorKeys();
	
				spacekey=game.input.keyboard.addKey(Phaser.Keyboard.UP);
				esckey=game.input.keyboard.addKey(Phaser.Keyboard.ESC);
				
				basket=game.add.sprite(wiw/2,wih-60,'basket');
				basket.scale.setTo(2.5,2.5);
				//added for mobile
				//basket.inputEnabled=true;
				//basket.input.enableDrag(false);
				//--****************--
				
				game.physics.arcade.enable(basket);

				basket.body.collideWorldBounds=true;
				basket.body.immovable=true;
				basket.body.allowGravity=false;

				
				group1=game.add.group();
				group1.enableBody=true;
				group1.physicsBodyType=Phaser.Physics.ARCADE;
				
				timer=game.time.create(false);
				timer.loop(2000,releaseObject,this);
				timer.start();
				
				scoreText = game.add.text(10, 10, 'Your score: 0', { font: "20px Arial", fill: "#000000", align: "left" });
				game.input.onTap.add(onTap,this);
				//game.input.onDown.add(move,this);
			}	
			function move(pointer)
			{
				
			}
			function onTap(pointer,doubleTap)
			{
				if(doubleTap)
				{
					reset();
					gameOverText=game.add.text(wiw/2-50, wih/2,'Your Score is'+score + '\nThank you for playing FruitBasket', { font: "20px Arial", fill: "#000000", align: "left" });	
				}	
				else
				{
					imageX=basket.body.x;
					imageY=basket.body.y;

					if(game.input.mousePointer.y>=imageY && game.input.mousePointer.y<=imageY+basket.body.height )
					{
						if(game.input.mousePointer.x<imageX)
						{
							//move left
							basket.body.velocity.x-=200;
						}
						else if(game.input.mousePointer.x>imageX)
						{
							//move right
							basket.body.velocity.x+=200;
						}
					}	
				}
			}
			function gameResized()
			{
    				scale = Math.min(window.innerWidth / this.game.width, window.innerHeight / this.game.height);
 				var manager=Phaser.ScaleManager;	
				manager.setUserScale(scale, scale, 0, 0);
			}		
			function update()
			{
				game.physics.arcade.collide(basket,group1,collisionHandler,null,this);
				
				
			}
			function render()
			{
				game.debug.pointer(game.input.mousePointer);
				game.debug.text(imageX,50,50);
				game.debug.text(imageY,100,50);
			}
			function collisionHandler(basket,sprite)
			{
				if(sprite.frame<3)
					score=score+10;
				else
					score=score-15;
				scoreText.text='Your score: '+score;
				sprite.kill();
				sprite.destroy();
			}
			function releaseObject()
			{
				var rnum=game.rnd.between(0,5);
				sprite=group1.create(game.rnd.between(1,game.width),0,'fandi',rnum);
				sprite.body.collideWorldBounds=true;
				sprite.body.gravity.x=game.rnd.integerInRange(-50,50);
				sprite.body.gravity.y=100+Math.random()*100;
				sprite.body.bounce.setTo(0.9,0.9);
				
			}
		</script>
	</body>
</html>